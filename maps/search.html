<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BarbellFinder is an easy way to find your next gym. Search hundreds of gym listings.">
    <meta name="msvalidate.01" content="C036FD7FE6F9C4782FAC3CC31A8EBEFB" />
    <title>BarbellFinder - Fast and Easy Gym Search</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWUIVQ6XyFm2qpZwJD1OY2rdJ1BOKw9lE&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
        width: 100%;
      }

      #side {
          width: 400px;
          overflow-y: scroll;
      }

      #content {
        display: flex;
        height: calc(100% - 64px);
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #floating-panel {
        position: absolute;
        top: 75px;
        left: 50%;
        z-index: 5;
        text-align: center;
        font-family: "Roboto", "sans-serif";
        line-height: 30px;
      }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-38QF05WV91"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-38QF05WV91');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-sm navbar-expand-md navbar-expand-lg navbar-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">BarbellFinder</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" href="./index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./owners.html">Owners</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./register.html">Add your gym</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./blog/">Blog</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./skipTheSearch.html">Skip the search</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./contact.html">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div id="floating-panel">
        <input id="address" type="textbox" value="Chicago, IL" />
        <input id="submit" type="button" value="Search" />
      </div>
      <div id="content">
          <div id="side" class="d-none d-sm-block">
              <div class="container">
                  <div class="row">
                    <div class="col-12">
                        <h1 class="h2">Searching gyms near Chicago, IL</h1>
                        <div id="gymsShown"></div>
                        <!-- <div id="amenities">
                            <h3>Amenities</h3>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="openGym" id="flexCheckDefault1">
                                <label class="form-check-label" for="flexCheckDefault1">
                                  Open Gym
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="personalCoaching" id="flexCheckDefault2">
                                <label class="form-check-label" for="flexCheckDefault2">
                                  1:1 Coaching
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="nutrition" id="flexCheckDefault3">
                                <label class="form-check-label" for="flexCheckDefault3">
                                  Nutrition
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="pool" id="flexCheckDefault4">
                                <label class="form-check-label" for="flexCheckDefault4">
                                  Pool
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="showers" id="flexCheckDefault5">
                                <label class="form-check-label" for="flexCheckDefault5">
                                  Showers
                                </label>
                            </div>
                        </div>
                        <div id="classes">

                        </div> -->
                        <div id="389421707">
                            <script type="text/javascript">
                            if (document.location.origin != 'file://') {
                                try {
                                    window._mNHandle.queue.push(function (){
                                        window._mNDetails.loadTag("389421707", "300x250", "389421707");
                                    });
                                }
                                catch (error) {}
                            }
                            </script>
                        </div>
                    </div>
                  </div>
              </div>
          </div>
          <div id="map"></div>
      </div>
      <script src="gyms.js"></script>
      <script>
        let map;
        let markers = [];
        updatePageValuesWithSearchQuery();
        
        document.getElementById("submit").addEventListener("click", () => {                       
            // Update url with search query
            let address = document.getElementById('address').value;
            const urlParams = new URLSearchParams(window.location.search);

            urlParams.set('search', address);
            document.location = `${location.pathname}?${urlParams.toString()}`;
        });
        
        /* Functions */
        function updatePageValuesWithSearchQuery() {   
            const urlParams = new URLSearchParams(window.location.search);         
            const query = urlParams.get('search') || 'Chicago, IL';
            
            document.getElementById('address').value = query;
            document.querySelector('title').innerHTML = `Gyms: ${query} | BarbellFinder`;
            document.querySelector('#side h1').innerHTML = `Searching gyms near ${query}`;
        }

        function initMap() {
          const myLatLng = { lat: 41.8781, lng: -87.6298 };
          const geocoder = new google.maps.Geocoder();

          map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: myLatLng,
            fullscreenControl: false,
            mapTypeControl: false,
            streetViewControl: false,
          });

          google.maps.event.addListener(map, 'bounds_changed', function() {
            const bounds =  map.getBounds();
            let shownMarkers = 0;
            
            // gyms is declared in gyms.js
            gyms.forEach(
                (gym) => {
                    if (bounds.contains(gym.coords)) {
                        // console.log(gym);
                        shownMarkers++;
                        addMarker(gym);
                    }
                }
            )
            
            document.querySelector('#side #gymsShown').innerHTML = `${shownMarkers} gyms shown`;
          });
  
          geocodeAddress(geocoder, map); 
        }
  
        function geocodeAddress(geocoder, resultsMap) {
            let address = document.getElementById('address').value;
          
            geocoder.geocode({ address: address }, (results, status) => {
                if (status === "OK") {
                resultsMap.setCenter(results[0].geometry.location);                
                
                // Log out the lat long coordinate
                console.log({"lat": results[0].geometry.location.lat(), "lng": results[0].geometry.location.lng()});
                } else {
                alert(
                    "Geocode was not successful for the following reason: " + status
                );
                }
            });
        }
  
        // Adds a marker to the map and push to the array.
        function addMarker(gym) {
            const checkmark = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">' +
  '<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>' +
"</svg>";
          const gymPhoneNumber = gym.phone ? "<p>" + gym.phone + "</p>" : '';
          const gymHasYoga = gym?.amenities?.yoga ? "<p>" + checkmark + " Yoga</p>" : '';
          const gymHasNutrition = gym?.amenities?.nutrition ? "<p>" + checkmark + " Nutrition</p>" : '';
          const gymHasClasses = gym?.amenities?.classes ? "<p>" + checkmark + " Classes</p>" : '';
          const detailsLink = `<p><a href="./details.html?lat=${gym.coords.lat}&lng=${gym.coords.lng}">View Details ></a></p>`;
          const contentString =
            '<div id="content">' +
            '<div id="bodyContent">' +
            "<h3>" + 
            gym.name +
            "</h3>" +
            "<p>" +
            gym.address +
            "</p>" +
            gymPhoneNumber +
            gymHasYoga +
            gymHasClasses +
            gymHasNutrition +
            detailsLink + 
            "</div>"
            "</div>";
  
          const infowindow = new google.maps.InfoWindow({
            content: contentString,
          });

          // Red Marker
          const marker = new google.maps.Marker({
            position: gym.coords,
            map: map,
          });

          // Blue Marker
        //   https://medium.com/free-code-camp/how-to-change-javascript-google-map-marker-color-8a72131d1207
        //   const marker = new google.maps.Marker({
        //     position: gym.coords,
        //     map: map,
        //     icon: {
        //     url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        //     },
        //   });
  
          marker.addListener("click", () => {
            infowindow.open(map, marker);
          });
  
          markers.push(marker);
        }
  
        // Removes the markers from the map, but keeps them in the array.
        function clearMarkers() {
          setMapOnAll(null);
        }
  
        // Deletes all markers in the array by removing references to them.
        function deleteMarkers() {
          clearMarkers();
          markers = [];
        }
      </script>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>